{% extends 'base.html' %}
{% load static %}

<!-- Page title -->
{% block title %}Login - Portuguese Kitchen{% endblock %}

<!-- Login page content -->
{% block content %}

<!-- Hero Section -->
<section class="auth-hero py-5 bg-light">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-4 text-center mb-4 mb-lg-0">
        <div class="portuguese-kitchen-logo">
          <i class="bi bi-pot display-1 text-primary mb-3"></i>
          <h3 class="fw-bold mb-0">PORTUGUESE<br>KITCHEN</h3>
        </div>
      </div>
      <div class="col-lg-8">
        <h2 class="display-5 fw-bold mb-3">Welcome Back</h2>
        <p class="lead mb-0">
          Login to manage your bookings and view your dining history
        </p>
      </div>
    </div>
  </div>
</section>

<!-- Login Form Section -->
<section class="auth-form-section py-5">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-5 col-md-7">
        
        <!-- Login Card -->
        <div class="auth-card bg-white p-5 rounded-3 shadow-sm">
          <h2 class="text-center mb-4">Login</h2>
          
          <!-- Display Messages -->
          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
            {% endfor %}
          {% endif %}

          <form method="POST" action="{% url 'accounts:login' %}" novalidate>
            {% csrf_token %}
            
            <!-- Username or Email -->
            <div class="mb-3">
              <label for="username" class="form-label fw-semibold">
                Username or Email <span class="text-danger">*</span>
              </label>
              <div class="input-group">
                <span class="input-group-text">
                  <i class="bi bi-person"></i>
                </span>
                <input 
                  type="text" 
                  class="form-control {% if form.username.errors %}is-invalid{% endif %}" 
                  id="username" 
                  name="username" 
                  value="{{ form.username.value|default:'' }}"
                  required
                  autofocus
                >
                {% if form.username.errors %}
                  <div class="invalid-feedback">
                    {{ form.username.errors.0 }}
                  </div>
                {% endif %}
              </div>
            </div>

            <!-- Password -->
            <div class="mb-3">
              <label for="password" class="form-label fw-semibold">
                Password <span class="text-danger">*</span>
              </label>
              <div class="input-group">
                <span class="input-group-text">
                  <i class="bi bi-lock"></i>
                </span>
                <input 
                  type="password" 
                  class="form-control {% if form.password.errors %}is-invalid{% endif %}" 
                  id="password" 
                  name="password"
                  required
                >
                <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                  <i class="bi bi-eye" id="eyeIcon"></i>
                </button>
                {% if form.password.errors %}
                  <div class="invalid-feedback">
                    {{ form.password.errors.0 }}
                  </div>
                {% endif %}
              </div>
            </div>

            <!-- Remember Me & Forgot Password -->
            <div class="d-flex justify-content-between align-items-center mb-4">
              <div class="form-check">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  id="remember" 
                  name="remember"
                >
                <label class="form-check-label" for="remember">
                  Remember me
                </label>
              </div>
              <a href="{% url 'accounts:password_reset' %}" class="text-primary small">
                Forgot password?
              </a>
            </div>

            <!-- Non-field errors -->
            {% if form.non_field_errors %}
              <div class="alert alert-danger">
                {{ form.non_field_errors.0 }}
              </div>
            {% endif %}

            <!-- Submit Button -->
            <div class="d-grid mb-3">
              <button type="submit" class="btn btn-primary btn-lg">
                Login
              </button>
            </div>

            <!-- Divider -->
            <div class="text-center mb-3">
              <span class="text-muted">or</span>
            </div>

            <!-- Guest Booking Link -->
            <div class="d-grid mb-3">
              <a href="{% url 'bookings:booking' %}" class="btn btn-outline-secondary">
                <i class="bi bi-calendar-check me-2"></i>
                Continue as Guest
              </a>
            </div>

            <!-- Register Link -->
            <div class="text-center">
              <p class="mb-0">
                Don't have an account? 
                <a href="{% url 'accounts:register' %}" class="text-primary fw-semibold">Register here</a>
              </p>
            </div>
          </form>

        </div>
        <!-- End Login Card -->

        <!-- Admin Login Link -->
        <div class="text-center mt-4">
          <p class="text-muted small">
            <i class="bi bi-shield-lock me-1"></i>
            Restaurant staff? <a href="/admin/" class="text-primary">Admin Login</a>
          </p>
        </div>

      </div>
    </div>
  </div>
</section>

{% endblock %}

<!-- Extra CSS -->
{% block extra_css %}
<style>
  /* Portuguese Kitchen Logo */
  .portuguese-kitchen-logo {
    padding: 1rem;
  }

  .portuguese-kitchen-logo h3 {
    font-family: var(--font-heading);
    color: var(--espresso-brown);
    line-height: 1.3;
    font-size: 1.5rem;
  }

  .portuguese-kitchen-logo i {
    color: var(--azulejo-blue);
  }

  /* Auth Hero */
  .auth-hero {
    border-bottom: 3px solid var(--olive-green);
    background-color: var(--linen-cream);
  }

  /* Auth Form Section */
  .auth-form-section {
    background-color: var(--linen-cream);
    min-height: 60vh;
  }

  /* Auth Card */
  .auth-card {
    border: 1px solid #dee2e6;
  }

  .auth-card h2 {
    color: var(--azulejo-blue);
    font-family: var(--font-heading);
  }

  /* Input Group */
  .input-group-text {
    background-color: var(--porcelain-white);
    border: 2px solid #dee2e6;
    border-right: none;
    color: var(--azulejo-blue);
  }

  .form-control {
    border: 2px solid #dee2e6;
    border-left: none;
  }

  .input-group .form-control:focus {
    border-color: var(--azulejo-blue);
    box-shadow: none;
  }

  .input-group .form-control:focus + .input-group-text,
  .input-group-text + .form-control:focus {
    border-color: var(--azulejo-blue);
  }

  /* Labels */
  .form-label {
    color: var(--espresso-brown);
    margin-bottom: 0.5rem;
  }

  /* Buttons */
  .btn-primary {
    background-color: var(--terracotta-red);
    border-color: var(--terracotta-red);
    font-weight: 600;
  }

  .btn-primary:hover {
    background-color: #a83829;
    border-color: #a83829;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  }

  .btn-outline-secondary {
    color: var(--espresso-brown);
    border-color: var(--espresso-brown);
    font-weight: 600;
  }

  .btn-outline-secondary:hover {
    background-color: var(--espresso-brown);
    border-color: var(--espresso-brown);
    color: white;
  }

  /* Password Toggle */
  #togglePassword {
    cursor: pointer;
    border-left: none;
  }

  /* Checkbox */
  .form-check-input:checked {
    background-color: var(--olive-green);
    border-color: var(--olive-green);
  }

  .form-check-label {
    color: var(--espresso-brown);
  }

  /* Links */
  a.text-primary {
    color: var(--azulejo-blue) !important;
    text-decoration: none;
  }

  a.text-primary:hover {
    text-decoration: underline;
  }

  /* Divider */
  .text-center span.text-muted {
    position: relative;
    padding: 0 1rem;
    background: white;
    z-index: 1;
  }

  .text-center span.text-muted::before {
    content: '';
    position: absolute;
    top: 50%;
    left: -100%;
    width: 200%;
    height: 1px;
    background: #dee2e6;
    z-index: -1;
  }

  /* Alert */
  .alert {
    border-radius: 0.375rem;
  }

  .alert-danger {
    background-color: #f8d7da;
    border-color: var(--terracotta-red);
    color: #842029;
  }

  /* Validation */
  .is-invalid {
    border-color: var(--terracotta-red) !important;
  }

  .invalid-feedback {
    color: var(--terracotta-red);
    font-size: 0.875rem;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .auth-card {
      padding: 2rem 1.5rem !important;
    }

    .portuguese-kitchen-logo h3 {
      font-size: 1.25rem;
    }

    .display-5 {
      font-size: 2rem;
    }
  }
</style>
{% endblock %}

<!-- Extra JavaScript -->
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Password toggle functionality
  const togglePassword = document.getElementById('togglePassword');
  const password = document.getElementById('password');
  const eyeIcon = document.getElementById('eyeIcon');

  if (togglePassword) {
    togglePassword.addEventListener('click', function() {
      const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
      password.setAttribute('type', type);
      eyeIcon.classList.toggle('bi-eye');
      eyeIcon.classList.toggle('bi-eye-slash');
    });
  }

  // Auto-dismiss alerts after 5 seconds
  const alerts = document.querySelectorAll('.alert');
  alerts.forEach(function(alert) {
    setTimeout(function() {
      const bsAlert = new bootstrap.Alert(alert);
      bsAlert.close();
    }, 5000);
  });
});
</script>
{% endblock %}