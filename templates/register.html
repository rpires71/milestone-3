{% extends 'base.html' %}
{% load static %}

<!-- Page title -->
{% block title %}Register - Portuguese Kitchen{% endblock %}

<!-- Registration page content -->
{% block content %}

<!-- Hero Section -->
<section class="auth-hero py-5 bg-light">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-4 text-center mb-4 mb-lg-0">
        <div class="portuguese-kitchen-logo">
          <i class="bi bi-pot display-1 text-primary mb-3"></i>
          <h3 class="fw-bold mb-0">PORTUGUESE<br>KITCHEN</h3>
        </div>
      </div>
      <div class="col-lg-8">
        <h2 class="display-5 fw-bold mb-3">Create Your Account</h2>
        <p class="lead mb-0">
          Join us to manage your bookings and enjoy exclusive benefits
        </p>
      </div>
    </div>
  </div>
</section>

<!-- Registration Form Section -->
<section class="auth-form-section py-5">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-6 col-md-8">
        
        <!-- Registration Card -->
        <div class="auth-card bg-white p-5 rounded-3 shadow-sm">
          <h2 class="text-center mb-4">Register</h2>
          
          <!-- Display Messages -->
          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
            {% endfor %}
          {% endif %}

          <form method="POST" action="{% url 'accounts:register' %}" novalidate>
            {% csrf_token %}
            
            <!-- Username -->
            <div class="mb-3">
              <label for="username" class="form-label fw-semibold">
                Username <span class="text-danger">*</span>
              </label>
              <input 
                type="text" 
                class="form-control {% if form.username.errors %}is-invalid{% endif %}" 
                id="username" 
                name="username" 
                value="{{ form.username.value|default:'' }}"
                required
                minlength="3"
                maxlength="150"
              >
              {% if form.username.errors %}
                <div class="invalid-feedback">
                  {{ form.username.errors.0 }}
                </div>
              {% else %}
                <div class="form-text">
                  3-150 characters. Letters, digits and @/./+/-/_ only.
                </div>
              {% endif %}
            </div>

            <!-- Email -->
            <div class="mb-3">
              <label for="email" class="form-label fw-semibold">
                Email Address <span class="text-danger">*</span>
              </label>
              <input 
                type="email" 
                class="form-control {% if form.email.errors %}is-invalid{% endif %}" 
                id="email" 
                name="email" 
                value="{{ form.email.value|default:'' }}"
                required
              >
              {% if form.email.errors %}
                <div class="invalid-feedback">
                  {{ form.email.errors.0 }}
                </div>
              {% endif %}
            </div>

            <!-- First Name -->
            <div class="mb-3">
              <label for="first_name" class="form-label fw-semibold">
                First Name <span class="text-danger">*</span>
              </label>
              <input 
                type="text" 
                class="form-control {% if form.first_name.errors %}is-invalid{% endif %}" 
                id="first_name" 
                name="first_name" 
                value="{{ form.first_name.value|default:'' }}"
                required
                maxlength="150"
              >
              {% if form.first_name.errors %}
                <div class="invalid-feedback">
                  {{ form.first_name.errors.0 }}
                </div>
              {% endif %}
            </div>

            <!-- Last Name -->
            <div class="mb-3">
              <label for="last_name" class="form-label fw-semibold">
                Last Name <span class="text-danger">*</span>
              </label>
              <input 
                type="text" 
                class="form-control {% if form.last_name.errors %}is-invalid{% endif %}" 
                id="last_name" 
                name="last_name" 
                value="{{ form.last_name.value|default:'' }}"
                required
                maxlength="150"
              >
              {% if form.last_name.errors %}
                <div class="invalid-feedback">
                  {{ form.last_name.errors.0 }}
                </div>
              {% endif %}
            </div>

            <!-- Password -->
            <div class="mb-3">
              <label for="password1" class="form-label fw-semibold">
                Password <span class="text-danger">*</span>
              </label>
              <div class="input-group">
                <input 
                  type="password" 
                  class="form-control {% if form.password1.errors %}is-invalid{% endif %}" 
                  id="password1" 
                  name="password1"
                  required
                  minlength="8"
                >
                <button class="btn btn-outline-secondary" type="button" id="togglePassword1">
                  <i class="bi bi-eye" id="eyeIcon1"></i>
                </button>
                {% if form.password1.errors %}
                  <div class="invalid-feedback">
                    {{ form.password1.errors.0 }}
                  </div>
                {% endif %}
              </div>
              <div class="form-text">
                At least 8 characters. Not entirely numeric.
              </div>
            </div>

            <!-- Confirm Password -->
            <div class="mb-3">
              <label for="password2" class="form-label fw-semibold">
                Confirm Password <span class="text-danger">*</span>
              </label>
              <div class="input-group">
                <input 
                  type="password" 
                  class="form-control {% if form.password2.errors %}is-invalid{% endif %}" 
                  id="password2" 
                  name="password2"
                  required
                  minlength="8"
                >
                <button class="btn btn-outline-secondary" type="button" id="togglePassword2">
                  <i class="bi bi-eye" id="eyeIcon2"></i>
                </button>
                {% if form.password2.errors %}
                  <div class="invalid-feedback">
                    {{ form.password2.errors.0 }}
                  </div>
                {% endif %}
              </div>
            </div>

            <!-- Terms Agreement -->
            <div class="mb-4">
              <div class="form-check">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  id="terms" 
                  name="terms"
                  required
                >
                <label class="form-check-label" for="terms">
                  I agree to the <a href="#" class="text-primary">Terms of Service</a> and <a href="#" class="text-primary">Privacy Policy</a>
                </label>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="d-grid mb-3">
              <button type="submit" class="btn btn-primary btn-lg">
                Create Account
              </button>
            </div>

            <!-- Login Link -->
            <div class="text-center">
              <p class="mb-0">
                Already have an account? 
                <a href="{% url 'accounts:login' %}" class="text-primary fw-semibold">Login here</a>
              </p>
            </div>
          </form>

        </div>
        <!-- End Registration Card -->

      </div>
    </div>
  </div>
</section>

{% endblock %}

<!-- Extra CSS -->
{% block extra_css %}
<style>
  /* Portuguese Kitchen Logo */
  .portuguese-kitchen-logo {
    padding: 1rem;
  }

  .portuguese-kitchen-logo h3 {
    font-family: var(--font-heading);
    color: var(--espresso-brown);
    line-height: 1.3;
    font-size: 1.5rem;
  }

  .portuguese-kitchen-logo i {
    color: var(--azulejo-blue);
  }

  /* Auth Hero */
  .auth-hero {
    border-bottom: 3px solid var(--olive-green);
    background-color: var(--linen-cream);
  }

  /* Auth Form Section */
  .auth-form-section {
    background-color: var(--linen-cream);
    min-height: 60vh;
  }

  /* Auth Card */
  .auth-card {
    border: 1px solid #dee2e6;
  }

  .auth-card h2 {
    color: var(--azulejo-blue);
    font-family: var(--font-heading);
  }

  /* Form Styling */
  .form-label {
    color: var(--espresso-brown);
  }

  .form-control,
  .form-select {
    border: 2px solid #dee2e6;
    transition: border-color 0.15s ease-in-out;
  }

  .form-control:focus {
    border-color: var(--azulejo-blue);
    box-shadow: 0 0 0 0.2rem rgba(31, 78, 121, 0.25);
  }

  .is-invalid {
    border-color: var(--terracotta-red);
  }

  .invalid-feedback {
    color: var(--terracotta-red);
    font-size: 0.875rem;
  }

  .form-text {
    color: #6c757d;
    font-size: 0.875rem;
  }

  /* Button Styling */
  .btn-primary {
    background-color: var(--terracotta-red);
    border-color: var(--terracotta-red);
    font-weight: 600;
  }

  .btn-primary:hover {
    background-color: #a83829;
    border-color: #a83829;
  }

  .btn-outline-secondary {
    border-color: #dee2e6;
  }

  /* Password Toggle */
  #togglePassword1,
  #togglePassword2 {
    cursor: pointer;
  }

  /* Checkbox */
  .form-check-input:checked {
    background-color: var(--olive-green);
    border-color: var(--olive-green);
  }

  /* Links */
  a.text-primary {
    color: var(--azulejo-blue) !important;
    text-decoration: none;
  }

  a.text-primary:hover {
    text-decoration: underline;
  }

  /* Alert */
  .alert {
    border-radius: 0.375rem;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .auth-card {
      padding: 2rem 1.5rem !important;
    }

    .portuguese-kitchen-logo h3 {
      font-size: 1.25rem;
    }

    .display-5 {
      font-size: 2rem;
    }
  }
</style>
{% endblock %}

<!-- Extra JavaScript -->
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Password toggle functionality
  const togglePassword1 = document.getElementById('togglePassword1');
  const password1 = document.getElementById('password1');
  const eyeIcon1 = document.getElementById('eyeIcon1');

  const togglePassword2 = document.getElementById('togglePassword2');
  const password2 = document.getElementById('password2');
  const eyeIcon2 = document.getElementById('eyeIcon2');

  togglePassword1.addEventListener('click', function() {
    const type = password1.getAttribute('type') === 'password' ? 'text' : 'password';
    password1.setAttribute('type', type);
    eyeIcon1.classList.toggle('bi-eye');
    eyeIcon1.classList.toggle('bi-eye-slash');
  });

  togglePassword2.addEventListener('click', function() {
    const type = password2.getAttribute('type') === 'password' ? 'text' : 'password';
    password2.setAttribute('type', type);
    eyeIcon2.classList.toggle('bi-eye');
    eyeIcon2.classList.toggle('bi-eye-slash');
  });

  // Password match validation
  const form = document.querySelector('form');
  form.addEventListener('submit', function(e) {
    if (password1.value !== password2.value) {
      e.preventDefault();
      password2.classList.add('is-invalid');
      
      // Show error message
      let feedback = password2.nextElementSibling;
      if (!feedback || !feedback.classList.contains('invalid-feedback')) {
        feedback = document.createElement('div');
        feedback.className = 'invalid-feedback';
        password2.parentNode.appendChild(feedback);
      }
      feedback.textContent = 'Passwords do not match.';
      feedback.style.display = 'block';
    }
  });

  // Remove error on typing
  password2.addEventListener('input', function() {
    if (password1.value === password2.value) {
      password2.classList.remove('is-invalid');
      const feedback = password2.parentNode.querySelector('.invalid-feedback');
      if (feedback) {
        feedback.style.display = 'none';
      }
    }
  });
});
</script>
{% endblock %}